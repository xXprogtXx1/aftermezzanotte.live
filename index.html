<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>aftermezzanotte.live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    :root {
      --bg: #050509;
      --bg-alt: #0b0b12;
      --accent: #ff006a;
      --accent-soft: rgba(255, 0, 106, 0.2);
      --text: #f5f5f5;
      --muted: #888;
      --danger: #ff3366;
      --success: #4ade80;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #141421, #050509 55%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .glow-orb {
      position: fixed;
      width: 420px;
      height: 420px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,0,106,0.55), transparent 65%);
      filter: blur(2px);
      top: -80px;
      right: -40px;
      pointer-events: none;
      opacity: 0.7;
    }
    .container {
      position: relative;
      width: 100%;
      max-width: 720px;
      margin: 24px;
      padding: 24px 20px;
      border-radius: 24px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.02), rgba(11, 11, 18, 0.95));
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 0 40px rgba(0, 0, 0, 0.85),
        0 0 80px rgba(255, 0, 106, 0.35);
      backdrop-filter: blur(18px);
      z-index: 1;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      background: rgba(0, 0, 0, 0.35);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      margin-bottom: 16px;
    }
    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--accent), transparent);
      box-shadow: 0 0 10px var(--accent);
    }
    h1 {
      font-size: clamp(32px, 6vw, 44px);
      margin-bottom: 6px;
    }
    h1 span {
      color: var(--accent);
    }
    .subtitle {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 24px;
      max-width: 520px;
    }

    /* COUNTDOWN VIEW */
    #countdown-view {
      display: none;
    }
    .countdown-box {
      margin-top: 4px;
      padding: 16px;
      border-radius: 16px;
      background: rgba(5, 5, 9, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .countdown-label {
      font-size: 14px;
      color: var(--muted);
    }
    .time-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }
    .time-unit {
      text-align: center;
      padding: 8px 6px;
      border-radius: 12px;
      background: radial-gradient(circle at top, rgba(255, 0, 106, 0.12), rgba(10, 10, 18, 0.95));
      border: 1px solid rgba(255, 255, 255, 0.12);
    }
    .time-value {
      font-size: 22px;
      font-weight: 600;
    }
    .time-unit span {
      display: block;
      margin-top: 2px;
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .info-line {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
      flex-wrap: wrap;
      gap: 4px;
    }

    /* NICK VIEW (post-mezzanotte “finta chat”) */
    #nick-view {
      display: none;
    }
    .nick-box {
      margin-top: 6px;
      padding: 16px;
      border-radius: 16px;
      background: rgba(5, 5, 9, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .nick-label {
      font-size: 14px;
      color: var(--muted);
    }
    .nick-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .nick-row input {
      flex: 1 1 180px;
      min-width: 0;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(0, 0, 0, 0.7);
      color: var(--text);
      outline: none;
      font-size: 14px;
    }
    .nick-row input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 0, 106, 0.4);
    }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #ff4f9a);
      color: #fff;
      box-shadow: 0 8px 25px rgba(255, 0, 106, 0.45);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 30px rgba(255, 0, 106, 0.75);
    }
    .btn-ghost {
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.08);
    }
    .nick-hint {
      font-size: 12px;
      color: var(--muted);
    }
    .nick-error {
      font-size: 12px;
      color: var(--danger);
      min-height: 16px;
    }

    .footer {
      margin-top: 16px;
      font-size: 11px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    @media (max-width: 480px) {
      .container {
        margin: 16px;
        padding: 20px 16px;
      }
      .time-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="glow-orb"></div>

  <main class="container">
    <div class="badge">
      <span class="badge-dot"></span>
      aftermezzanotte.live · beta
    </div>

    <h1>Ci vediamo <span>dopo mezzanotte</span>.</h1>
    <p class="subtitle">
      Una stanza globale, nessun login, solo nickname.  
      La porta si apre alla mezzanotte italiana. Fino ad allora, puoi solo guardare il tempo scorrere.
    </p>

    <!-- VIEW: COUNTDOWN PRIMA DI MEZZANOTTE -->
    <section id="countdown-view">
      <div class="countdown-box">
        <div class="countdown-label">
          Mancano a mezzanotte (ora italiana):
        </div>
        <div class="time-grid">
          <div class="time-unit">
            <div id="h-val" class="time-value">--</div>
            <span>ore</span>
          </div>
          <div class="time-unit">
            <div id="m-val" class="time-value">--</div>
            <span>minuti</span>
          </div>
          <div class="time-unit">
            <div id="s-val" class="time-value">--</div>
            <span>secondi</span>
          </div>
          <div class="time-unit">
            <div id="until-text" class="time-value" style="font-size:14px;">–</div>
            <span>prossima</span>
          </div>
        </div>
        <div class="info-line">
          <span>Time zone: Europe/Rome</span>
          <span id="now-text"></span>
        </div>
      </div>
    </section>

    <!-- VIEW: NICKNAME + CHAT (post mezzanotte) -->
    <section id="nick-view">
      <div class="nick-box">
        <div class="nick-label">
          È dopo mezzanotte. Per entrare nella stanza globale scegli un nickname:
        </div>
        <div class="nick-row">
          <input
            id="nick-input"
            type="text"
            minlength="2"
            maxlength="18"
            placeholder="es. miczy, nightwalker, anon-13..."
            autocomplete="off"
          />
          <button class="btn btn-primary" id="nick-continue">
            Entra
          </button>
        </div>
        <div class="nick-hint">
          Nessun account, nessun login. Il nickname esiste solo per questa sessione.
        </div>
        <div id="nick-error" class="nick-error"></div>
      </div>

      <!-- Placeholder che poi diventerà la chat vera -->
      <div style="margin-top: 12px; font-size: 13px; color: var(--muted);">
        <span class="pill">
          Chat globale in arrivo · Il backend WebSocket non è ancora collegato.
        </span>
      </div>
    </section>

    <footer class="footer">
      <span>aftermezzanotte.live · ora italiana</span>
      <span>v0.1 · frontend statico su GitHub Pages</span>
    </footer>
  </main>

  <script>
    // helper per avere sempre l'ora italiana lato client
    function getNowRome() {
      const now = new Date();
      // Ottieni stringa in it-IT / Europe-Rome e riconverti in Date locale
      const formatter = new Intl.DateTimeFormat("it-IT", {
        timeZone: "Europe/Rome",
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
      const parts = formatter.formatToParts(now).reduce((acc, p) => {
        acc[p.type] = p.value;
        return acc;
      }, {});
      const isoLike =
        parts.year + "-" +
        parts.month + "-" +
        parts.day + "T" +
        parts.hour + ":" +
        parts.minute + ":" +
        parts.second;
      return new Date(isoLike);
    }

    function getNextMidnightRome(fromDateRome) {
      const d = new Date(fromDateRome.getTime());
      d.setHours(24, 0, 0, 0); // porta alle 24:00 (mezzanotte successiva)
      return d;
    }

    const countdownView = document.getElementById("countdown-view");
    const nickView = document.getElementById("nick-view");

    const hVal = document.getElementById("h-val");
    const mVal = document.getElementById("m-val");
    const sVal = document.getElementById("s-val");
    const untilText = document.getElementById("until-text");
    const nowText = document.getElementById("now-text");

    const nickInput = document.getElementById("nick-input");
    const nickBtn = document.getElementById("nick-continue");
    const nickError = document.getElementById("nick-error");

    function setView(isAfterMidnight) {
      if (isAfterMidnight) {
        countdownView.style.display = "none";
        nickView.style.display = "block";
      } else {
        countdownView.style.display = "block";
        nickView.style.display = "none";
      }
    }

    function updateCountdown() {
      const nowRome = getNowRome();
      const nextMidnightRome = getNextMidnightRome(nowRome);
      const diffMs = nextMidnightRome - nowRome;

      const hh = nowRome.getHours();
      const mm = nowRome.getMinutes();
      const ss = nowRome.getSeconds();

      nowText.textContent =
        "Ora italiana: " +
        hh.toString().padStart(2, "0") + ":" +
        mm.toString().padStart(2, "0") + ":" +
        ss.toString().padStart(2, "0");

      // se diff <= 0 siamo nel nuovo giorno dopo mezzanotte
      if (diffMs <= 0) {
        setView(true);
        return;
      }

      const totalSec = Math.floor(diffMs / 1000);
      const hours = Math.floor(totalSec / 3600);
      const minutes = Math.floor((totalSec % 3600) / 60);
      const seconds = totalSec % 60;

      hVal.textContent = hours.toString().padStart(2, "0");
      mVal.textContent = minutes.toString().padStart(2, "0");
      sVal.textContent = seconds.toString().padStart(2, "0");
      untilText.textContent = "00:00";
    }

    // Init: decidi subito che view mostrare
    (function init() {
      const nowRome = getNowRome();
      const isAfterMidnight = nowRome.getHours() === 0 ||
                              nowRome.getHours() > 0;
      // In pratica: se è tra 00:00:00 e 23:59:59, ma decideremo col diffMs
      const nextMidnightRome = getNextMidnightRome(nowRome);
      const diffMs = nextMidnightRome - nowRome;
      if (diffMs <= 0) {
        setView(true);
      } else {
        setView(false);
        updateCountdown();
        setInterval(updateCountdown, 1000);
      }

      // nickname: per ora solo validazione base
      nickBtn.addEventListener("click", () => {
        const nick = nickInput.value.trim();
        if (nick.length < 2) {
          nickError.textContent = "Il nickname deve avere almeno 2 caratteri.";
          return;
        }
        if (nick.length > 18) {
          nickError.textContent = "Massimo 18 caratteri.";
          return;
        }
        nickError.textContent = "";
        // Qui in futuro: salva nickname (localStorage) e collega a WebSocket
        localStorage.setItem("aftermezzanotte_nick", nick);
        nickBtn.textContent = "Nickname salvato ✓";
        nickBtn.disabled = true;
        nickBtn.classList.add("btn-ghost");
        setTimeout(() => {
          nickBtn.textContent = "Entra";
          nickBtn.disabled = false;
          nickBtn.classList.remove("btn-ghost");
        }, 2000);
      });

      nickInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          nickBtn.click();
        }
      });

      // se c'è già un nick salvato, lo precompiliamo
      const savedNick = localStorage.getItem("aftermezzanotte_nick");
      if (savedNick) {
        nickInput.value = savedNick;
      }
    })();
  </script>
</body>
</html>
